## Εγκατάσταση Mosquitto στο Raspberry Pi 4 
## (Κεντρικός server του «Αυτόματου Σχολικού Βοηθού» του Σχολείου)

Σε αυτήν την ενότητα, θα  δείξουμε πώς να εγκαταστήσουμε τον μεσίτη (broker) Mosquitto στο Raspberry Pi.

Πριν προχωρήσουμε, καλό είναι να ρυθμίσουμε το **Raspberry Pi με μια στατική διεύθυνση IP** .

Μια στατική διεύθυνση IP μας παρέχει ένα εύκολο σημείο σύνδεσης που δεν θα πρέπει ποτέ να αλλάξει κατά τη διάρκεια πολλαπλών επανεκκινήσεων.

**1.** Πριν εγκαταστήσουμε τον μεσίτη MQTT στο Raspberry Pi, πρέπει να ενημερώσουμε το λειτουργικό σύστημα.

Το μόνο που χρειάζεται να κάνουμε για να ενημερώσουμε το σύστημα είναι να εκτελέσουμε τις ακόλουθες δύο εντολές.

```
sudo apt update
sudo apt upgrade
```

**2.** Μόλις ολοκληρωθεί η ενημέρωση του συστήματος, μπορούμε τώρα να εγκαταστήσουμε το λογισμικό Mosquitto.
Ο μεσίτης Mosquitto MQTT είναι διαθέσιμος ως μέρος του αποθετηρίου Raspbian, οπότε η εγκατάσταση του λογισμικού είναι απλή.

Εκτελέστε την ακόλουθη εντολή για να εγκαταστήσετε το Mosquitto μαζί με το λογισμικό πελάτη του.

```
sudo apt install mosquitto mosquitto-clients
```

Το λογισμικό πελάτη (client) θα μας επιτρέψει να αλληλεπιδράσουμε και να ελέγξουμε ότι ο μεσίτης MQTT λειτουργεί σωστά στο Raspberry Pi.

Κατά τη διαδικασία εγκατάστασης, ο διαχειριστής πακέτων θα ρυθμίσει αυτόματα τον διακομιστή Mosquitto για εκκίνηση κατά την εκκίνηση.

**3.** Σε αυτό το σημείο, θα έχετε πλέον τον μεσίτη Mosquitto MQTT σε λειτουργία στη συσκευή σας.

Μπορείτε να επαληθεύσετε ότι είναι εγκατεστημένο και λειτουργεί χρησιμοποιώντας την παρακάτω εντολή.

```bash
sudo systemctl status mosquitto
```

Αυτή η εντολή θα επιστρέψει την κατάσταση του `mosquitto  service` " ".

Θα πρέπει να δείτε το κείμενο " `active (running)`" εάν η υπηρεσία έχει ξεκινήσει σωστά.

## Δοκιμή της εγκατάστασης Mosquitto στο Raspberry Pi

Το επόμενο βήμα μας θα είναι να ελέγξουμε ότι η υπηρεσία λειτουργεί όπως θα έπρεπε και τώρα λειτουργεί ως μεσίτης MQTT στο Raspberry Pi μας.

Για να γίνει αυτό, θα κάνουμε χρήση του προγράμματος -πελάτη Mosquitto που εγκαταστήσαμε νωρίτερα σε αυτόν τον οδηγό.

Για αυτήν την ενότητα, θα πρέπει να ανοίξετε δύο τερματικές συνεδρίες στο Raspberry Pi σας (είτε τοπικά είτε μέσω SSH ).

**1.**Το πρώτο, που κάνουμε, είναι να δημιουργήσουμε έναν συνδρομητή. Ο συνδρομητής είναι αυτό που θα ακούσει τον μεσίτη MQTT που τρέχει στο Raspberry Pi.

Μπορούμε να χρησιμοποιήσουμε το πρόγραμμα Mosquitto για συνδρομητές που εγκαταστήσαμε νωρίτερα για να το κάνουμε αυτό.

Στο παρακάτω παράδειγμά μας, ξεκινούμε μι ασύνδεση στον `localhost` και περιμένουμε μηνύματα από τον μεσίτη για το `mqtt/pimylifeup` θέμα .

```
mosquitto_sub -h localhost -t "mqtt/pimylifeup"
```

Χρησιμοποιώντας το `-h`, μπορείτε να καθορίσετε το όνομα κεντρικού υπολογιστή στον οποίο θέλετε να συνδεθείτε. Στην περίπτωσή μας, χρησιμοποιούμε τον τοπικό μεσίτη MQTT που εγκαταστήσαμε στο Raspberry Pi.

Στη συνέχεια, χρησιμοποιούμε το `-t`  για να πούμε στον συνδρομητή Mosquitto ποιο θέμα πρέπει να ακούσουμε από τον μεσίτη MQTT.

Για το παράδειγμά μας, ακούμε ένα θέμα που ονομάζεται " `mqtt/pimylifeup`".

**2.** Τώρα που έχουμε έναν πελάτη φορτωμένο και ακούει μηνύματα, ας δοκιμάσουμε να το δημοσιεύσουμε.

Πρέπει να χρησιμοποιήσουμε τον πελάτη εκδότη MQTT που εγκαταστήσαμε στο Raspberry Pi νωρίτερα για να δημοσιεύσουμε ένα μήνυμα στο θέμα (topic).

Εκτελέστε την ακόλουθη εντολή για να δημοσιεύσετε το μήνυμα " `EPAL KALHMERA`" στον `localhost`διακομιστή μας στο `mqtt/pimylifeup` θέμα (topic).

```
mosquitto_pub -h localhost -t "mqtt/pimylifeup" -m "EPAL KALHMERA"
```

Δύο από τα ορίσματα είναι ίδια με την προηγούμενη εντολή, με το " `-h`" να καθορίζει τον διακομιστή για σύνδεση και " `-t`" να καθορίζει το θέμα προς δημοσίευση.

Το  επιπλέον που χρησιμοποιούμε εδώ είναι το όρισμα `-m` . Αυτό το όρισμα σάς επιτρέπει να καθορίσετε το μήνυμα που θέλετε να στείλετε στον μεσίτη Raspberry Pi MQTT.

**3.** Πίσω στη συνεδρία τερματικού όπου ξεκινήσατε τον εκδότη Mosquitto, θα πρέπει τώρα να δείτε το μήνυμά σας να εμφανίζεται.

Εάν ακολουθήσατε το παράδειγμά μας, θα πρέπει να δείτε το ακόλουθο κείμενο να εμφανίζεται στη γραμμή εντολών.

```
EPAL KALHMERA
```
Για επιπλέον οδηγίες και ανάλυση , μπορούμε να επισκευθούμε τους παρακάτω ιστότοπους, τους οποίους χρησιμοποήσαμε και εμείς για την εγκατάσταση και για την δημιουργία του οδηγού αυτού

https://randomnerdtutorials.com/how-to-install-mosquitto-broker-on-raspberry-pi/

https://pimylifeup.com/raspberry-pi-mosquitto-mqtt-server/
